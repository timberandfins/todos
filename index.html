<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task & Notes Manager</title>
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#5a4a3a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tasks">
    
    <!-- Inline icon as data URI -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='512' height='512' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235a4a3a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232c2416;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' fill='url(%23bg)' rx='80'/%3E%3Crect x='226' y='320' width='60' height='120' fill='%236b4423'/%3E%3Cpath d='M 256 120 L 360 280 L 152 280 Z' fill='%233d5a3c'/%3E%3Cpath d='M 256 180 L 340 310 L 172 310 Z' fill='%234a6b49'/%3E%3Cpath d='M 256 240 L 320 340 L 192 340 Z' fill='%235a7a59'/%3E%3Ccircle cx='256' cy='200' r='8' fill='%23c87941' opacity='0.6'/%3E%3Ccircle cx='290' cy='240' r='6' fill='%23c87941' opacity='0.6'/%3E%3Ccircle cx='220' cy='260' r='7' fill='%23c87941' opacity='0.6'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg width='512' height='512' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235a4a3a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232c2416;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' fill='url(%23bg)' rx='80'/%3E%3Crect x='226' y='320' width='60' height='120' fill='%236b4423'/%3E%3Cpath d='M 256 120 L 360 280 L 152 280 Z' fill='%233d5a3c'/%3E%3Cpath d='M 256 180 L 340 310 L 172 310 Z' fill='%234a6b49'/%3E%3Cpath d='M 256 240 L 320 340 L 192 340 Z' fill='%235a7a59'/%3E%3Ccircle cx='256' cy='200' r='8' fill='%23c87941' opacity='0.6'/%3E%3Ccircle cx='290' cy='240' r='6' fill='%23c87941' opacity='0.6'/%3E%3Ccircle cx='220' cy='260' r='7' fill='%23c87941' opacity='0.6'/%3E%3C/svg%3E">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --timber-dark: #2c2416;
            --timber-brown: #5a4a3a;
            --timber-tan: #8b7355;
            --timber-cream: #d4c4b0;
            --timber-light: #f5f1eb;
            --forest-green: #3d5a3c;
            --forest-light: #5a7a59;
            --accent-orange: #c87941;
            --leather-texture: #a67c52;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--timber-brown) 0%, var(--timber-dark) 100%);
            min-height: 100vh;
            padding: 10px;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--timber-light);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .container {
                border-radius: 20px;
            }
        }

        .header {
            background: linear-gradient(135deg, var(--timber-dark) 0%, var(--timber-brown) 100%);
            color: var(--timber-cream);
            padding: 20px 15px;
            text-align: center;
            border-bottom: 3px solid var(--accent-orange);
        }

        @media (min-width: 768px) {
            .header {
                padding: 30px;
            }
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        @media (min-width: 768px) {
            .header p {
                font-size: 1.1em;
            }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            background: var(--timber-cream);
            border-bottom: 2px solid var(--timber-tan);
        }

        @media (min-width: 768px) {
            .controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 20px 30px;
                gap: 15px;
            }
        }

        .view-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        @media (min-width: 768px) {
            .view-selector {
                display: flex;
                gap: 10px;
            }
        }

        .view-btn {
            padding: 10px 15px;
            border: 2px solid var(--timber-brown);
            background: white;
            color: var(--timber-brown);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .view-btn {
                padding: 10px 20px;
            }
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .view-btn.active {
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--forest-light) 100%);
            color: white;
            border-color: var(--forest-green);
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .date-nav {
                width: auto;
                gap: 15px;
            }
        }

        .date-nav button {
            padding: 8px 12px;
            border: none;
            background: var(--timber-brown);
            color: var(--timber-cream);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s;
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .date-nav button {
                padding: 8px 15px;
            }
        }

        .date-nav button:hover {
            background: var(--timber-dark);
        }

        .current-date {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--timber-dark);
            text-align: center;
            flex: 1;
        }

        @media (min-width: 768px) {
            .current-date {
                font-size: 1.1em;
                min-width: 200px;
            }
        }

        .export-btn {
            padding: 10px 20px;
            border: none;
            background: var(--accent-orange);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
        }

        @media (min-width: 768px) {
            .export-btn {
                width: auto;
            }
        }

        .export-btn:hover {
            background: #b56730;
            transform: translateY(-2px);
        }

        .content {
            padding: 15px;
            min-height: 400px;
        }

        @media (min-width: 768px) {
            .content {
                padding: 30px;
                min-height: 500px;
            }
        }

        .task-input-section {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--timber-tan);
        }

        @media (min-width: 768px) {
            .task-input-section {
                padding: 20px;
                margin-bottom: 30px;
            }
        }

        .task-input-section h3 {
            margin-bottom: 15px;
            color: var(--timber-dark);
            font-size: 1.1em;
        }

        @media (min-width: 768px) {
            .task-input-section h3 {
                font-size: 1.2em;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
        }

        @media (min-width: 768px) {
            .input-group {
                flex-direction: row;
                margin-bottom: 15px;
            }
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--timber-cream);
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            background: var(--timber-light);
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--timber-brown);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .add-btn {
            padding: 12px 30px;
            border: none;
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--forest-light) 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s;
            width: 100%;
        }

        @media (min-width: 768px) {
            .add-btn {
                width: auto;
            }
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(61, 90, 60, 0.4);
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        @media (min-width: 768px) {
            .tasks-list {
                gap: 15px;
            }
        }

        .task-item {
            background: white;
            border: 2px solid var(--timber-tan);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s;
            position: relative;
        }

        @media (min-width: 768px) {
            .task-item {
                padding: 20px;
            }
        }

        .task-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .task-item.completed {
            opacity: 0.65;
            border-color: var(--forest-green);
            background: #f0f5f0;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
            gap: 10px;
        }

        .task-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--timber-dark);
            flex: 1;
            word-break: break-word;
        }

        @media (min-width: 768px) {
            .task-title {
                font-size: 1.2em;
            }
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-meta {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .task-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        @media (min-width: 768px) {
            .task-badge {
                padding: 4px 12px;
                font-size: 0.85em;
            }
        }

        .badge-daily {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-weekly {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .badge-monthly {
            background: #fff3e0;
            color: #e65100;
        }

        .badge-yearly {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .task-date {
            color: var(--timber-brown);
            font-size: 0.85em;
            font-weight: 500;
        }

        @media (min-width: 768px) {
            .task-date {
                font-size: 0.9em;
            }
        }

        .task-notes {
            color: var(--timber-brown);
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-actions button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .task-actions button {
                padding: 8px 16px;
            }
        }

        .complete-btn {
            background: var(--forest-green);
            color: white;
        }

        .complete-btn:hover {
            background: var(--forest-light);
        }

        .edit-btn {
            background: var(--accent-orange);
            color: white;
        }

        .edit-btn:hover {
            background: #b56730;
        }

        .delete-btn {
            background: #a0522d;
            color: white;
        }

        .delete-btn:hover {
            background: #8b4513;
        }

        .week-view {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 768px) {
            .week-view {
                grid-template-columns: repeat(7, 1fr);
                gap: 15px;
            }
        }

        .day-column {
            background: white;
            border: 2px solid var(--timber-tan);
            border-radius: 12px;
            padding: 12px;
            min-height: 200px;
        }

        @media (min-width: 768px) {
            .day-column {
                padding: 15px;
                min-height: 300px;
            }
        }

        .day-header {
            font-weight: 600;
            color: var(--timber-dark);
            margin-bottom: 12px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--timber-cream);
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            .day-header {
                font-size: 1em;
            }
        }

        .month-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        @media (min-width: 768px) {
            .month-view {
                gap: 10px;
            }
        }

        .month-day {
            background: white;
            border: 2px solid var(--timber-cream);
            border-radius: 8px;
            padding: 8px;
            min-height: 70px;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .month-day {
                padding: 10px;
                min-height: 100px;
            }
        }

        .month-day:hover {
            border-color: var(--timber-brown);
        }

        .month-day-number {
            font-weight: 600;
            color: var(--timber-brown);
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        @media (min-width: 768px) {
            .month-day-number {
                font-size: 1em;
            }
        }

        .month-day.other-month {
            opacity: 0.3;
        }

        .month-day.today {
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--forest-light) 100%);
            color: white;
            border-color: var(--forest-green);
        }

        .month-day.today .month-day-number {
            color: white;
        }

        .task-count {
            font-size: 0.75em;
            color: var(--timber-brown);
            margin-top: 5px;
        }

        .year-view {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (min-width: 768px) {
            .year-view {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
        }

        .month-card {
            background: white;
            border: 2px solid var(--timber-tan);
            border-radius: 12px;
            padding: 15px;
        }

        .month-name {
            font-weight: 600;
            color: var(--timber-dark);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1em;
        }

        @media (min-width: 768px) {
            .month-name {
                font-size: 1.1em;
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--timber-brown);
        }

        @media (min-width: 768px) {
            .empty-state {
                padding: 60px 20px;
            }
        }

        .empty-state h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: var(--timber-dark);
        }

        @media (min-width: 768px) {
            .empty-state h3 {
                font-size: 1.5em;
            }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(44, 36, 22, 0.8);
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--timber-light);
            padding: 20px;
            border: 3px solid var(--timber-brown);
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            margin: auto;
        }

        @media (min-width: 768px) {
            .modal-content {
                padding: 30px;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--timber-dark);
            font-size: 1.3em;
        }

        @media (min-width: 768px) {
            .modal-header h2 {
                font-size: 1.5em;
            }
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--timber-brown);
            padding: 0;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--timber-dark);
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .modal-footer {
                flex-direction: row;
                justify-content: flex-end;
            }
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--forest-green) 0%, var(--forest-light) 100%);
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(61, 90, 60, 0.4);
        }

        .modal-btn.secondary {
            background: var(--timber-cream);
            color: var(--timber-dark);
            border: 2px solid var(--timber-brown);
        }

        .modal-btn.secondary:hover {
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå≤ Task & Notes Manager</h1>
            <p>Organize your daily, weekly, monthly, and yearly tasks</p>
        </div>

        <div class="controls">
            <div class="view-selector">
                <button class="view-btn active" data-view="day">Daily</button>
                <button class="view-btn" data-view="week">Weekly</button>
                <button class="view-btn" data-view="month">Monthly</button>
                <button class="view-btn" data-view="year">Yearly</button>
            </div>

            <div class="date-nav">
                <button id="prevBtn">‚Üê</button>
                <div class="current-date" id="currentDate"></div>
                <button id="nextBtn">‚Üí</button>
            </div>

            <button class="export-btn" id="exportBtn">üìÑ Export PDF</button>
        </div>

        <div class="content">
            <div class="task-input-section">
                <h3>Add New Task/Note</h3>
                <div class="input-group">
                    <input type="text" id="taskTitle" placeholder="Task title...">
                    <select id="taskType">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Long-term</option>
                    </select>
                </div>
                <div class="input-group">
                    <input type="date" id="taskDate">
                </div>
                <div class="input-group">
                    <textarea id="taskNotes" placeholder="Notes (optional)..."></textarea>
                </div>
                <button class="add-btn" id="addTaskBtn">Add Task</button>
            </div>

            <div id="tasksContainer"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Task</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="input-group">
                <input type="text" id="editTitle" placeholder="Task title...">
            </div>
            <div class="input-group">
                <select id="editType">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Long-term</option>
                </select>
            </div>
            <div class="input-group">
                <input type="date" id="editDate">
            </div>
            <div class="input-group">
                <textarea id="editNotes" placeholder="Notes (optional)..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="cancelEdit">Cancel</button>
                <button class="modal-btn primary" id="saveEdit">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Inline manifest as JSON
        const manifestData = {
            "name": "Task & Notes Manager",
            "short_name": "Tasks",
            "description": "Organize your daily, weekly, monthly, and yearly tasks",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#2c2416",
            "theme_color": "#5a4a3a",
            "orientation": "portrait-primary",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg width='192' height='192' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235a4a3a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232c2416;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='192' height='192' fill='url(%23bg)' rx='30'/%3E%3Crect x='84' y='120' width='24' height='48' fill='%236b4423'/%3E%3Cpath d='M 96 45 L 135 105 L 57 105 Z' fill='%233d5a3c'/%3E%3Cpath d='M 96 67.5 L 127.5 116.25 L 64.5 116.25 Z' fill='%234a6b49'/%3E%3Cpath d='M 96 90 L 120 127.5 L 72 127.5 Z' fill='%235a7a59'/%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg width='512' height='512' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235a4a3a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232c2416;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' fill='url(%23bg)' rx='80'/%3E%3Crect x='226' y='320' width='60' height='120' fill='%236b4423'/%3E%3Cpath d='M 256 120 L 360 280 L 152 280 Z' fill='%233d5a3c'/%3E%3Cpath d='M 256 180 L 340 310 L 172 310 Z' fill='%234a6b49'/%3E%3Cpath d='M 256 240 L 320 340 L 192 340 Z' fill='%235a7a59'/%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        // Create and inject manifest as blob URL
        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);

        // Inline Service Worker registration
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'task-manager-v1';
                
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME).then(cache => {
                            return cache.addAll(['./', './index.html']);
                        })
                    );
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request).then(response => {
                            return response || fetch(event.request);
                        })
                    );
                });
                
                self.addEventListener('activate', event => {
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(blob);
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swURL)
                    .then(registration => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed'));
            });
        }

        class TaskManager {
            constructor() {
                this.tasks = this.loadTasks();
                this.currentView = 'day';
                this.currentDate = new Date();
                this.editingTaskId = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setDefaultDate();
                this.render();
            }

            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('taskDate').value = today;
            }

            setupEventListeners() {
                // View buttons
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentView = e.target.dataset.view;
                        this.render();
                    });
                });

                // Navigation buttons
                document.getElementById('prevBtn').addEventListener('click', () => this.navigate(-1));
                document.getElementById('nextBtn').addEventListener('click', () => this.navigate(1));

                // Add task button
                document.getElementById('addTaskBtn').addEventListener('click', () => this.addTask());

                // Export button
                document.getElementById('exportBtn').addEventListener('click', () => this.exportToPDF());

                // Modal buttons
                document.getElementById('closeModal').addEventListener('click', () => this.closeEditModal());
                document.getElementById('cancelEdit').addEventListener('click', () => this.closeEditModal());
                document.getElementById('saveEdit').addEventListener('click', () => this.saveTaskEdit());

                // Enter key to add task
                document.getElementById('taskTitle').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTask();
                });

                // Click outside modal to close
                document.getElementById('editModal').addEventListener('click', (e) => {
                    if (e.target.id === 'editModal') this.closeEditModal();
                });
            }

            navigate(direction) {
                switch(this.currentView) {
                    case 'day':
                        this.currentDate.setDate(this.currentDate.getDate() + direction);
                        break;
                    case 'week':
                        this.currentDate.setDate(this.currentDate.getDate() + (direction * 7));
                        break;
                    case 'month':
                        this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                        break;
                    case 'year':
                        this.currentDate.setFullYear(this.currentDate.getFullYear() + direction);
                        break;
                }
                this.render();
            }

            addTask() {
                const title = document.getElementById('taskTitle').value.trim();
                const type = document.getElementById('taskType').value;
                const date = document.getElementById('taskDate').value;
                const notes = document.getElementById('taskNotes').value.trim();

                if (!title) {
                    alert('Please enter a task title');
                    return;
                }

                if (!date) {
                    alert('Please select a date');
                    return;
                }

                const task = {
                    id: Date.now(),
                    title,
                    type,
                    date,
                    notes,
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                this.tasks.push(task);
                this.saveTasks();
                
                // Clear inputs
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskNotes').value = '';
                
                this.render();
            }

            openEditModal(id) {
                const task = this.tasks.find(t => t.id === id);
                if (!task) return;

                this.editingTaskId = id;
                document.getElementById('editTitle').value = task.title;
                document.getElementById('editType').value = task.type;
                document.getElementById('editDate').value = task.date;
                document.getElementById('editNotes').value = task.notes || '';
                
                document.getElementById('editModal').classList.add('active');
            }

            closeEditModal() {
                this.editingTaskId = null;
                document.getElementById('editModal').classList.remove('active');
            }

            saveTaskEdit() {
                const task = this.tasks.find(t => t.id === this.editingTaskId);
                if (!task) return;

                const title = document.getElementById('editTitle').value.trim();
                if (!title) {
                    alert('Please enter a task title');
                    return;
                }

                task.title = title;
                task.type = document.getElementById('editType').value;
                task.date = document.getElementById('editDate').value;
                task.notes = document.getElementById('editNotes').value.trim();

                this.saveTasks();
                this.closeEditModal();
                this.render();
            }

            toggleComplete(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    this.saveTasks();
                    this.render();
                }
            }

            deleteTask(id) {
                if (confirm('Are you sure you want to delete this task?')) {
                    this.tasks = this.tasks.filter(t => t.id !== id);
                    this.saveTasks();
                    this.render();
                }
            }

            getTasksForDate(date) {
                const dateStr = this.formatDate(date);
                return this.tasks.filter(t => t.date === dateStr);
            }

            getTasksForWeek(startDate) {
                const tasks = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + i);
                    tasks.push({
                        date: new Date(date),
                        tasks: this.getTasksForDate(date)
                    });
                }
                return tasks;
            }

            getTasksForMonth(year, month) {
                return this.tasks.filter(t => {
                    const taskDate = new Date(t.date);
                    return taskDate.getFullYear() === year && taskDate.getMonth() === month;
                });
            }

            getTasksForYear(year) {
                return this.tasks.filter(t => {
                    const taskDate = new Date(t.date);
                    return taskDate.getFullYear() === year;
                });
            }

            formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            formatDateDisplay(date) {
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

            getWeekStart(date) {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day;
                return new Date(d.setDate(diff));
            }

            render() {
                this.updateDateDisplay();
                
                switch(this.currentView) {
                    case 'day':
                        this.renderDayView();
                        break;
                    case 'week':
                        this.renderWeekView();
                        break;
                    case 'month':
                        this.renderMonthView();
                        break;
                    case 'year':
                        this.renderYearView();
                        break;
                }
            }

            updateDateDisplay() {
                const dateDisplay = document.getElementById('currentDate');
                
                switch(this.currentView) {
                    case 'day':
                        dateDisplay.textContent = this.formatDateDisplay(this.currentDate);
                        break;
                    case 'week':
                        const weekStart = this.getWeekStart(this.currentDate);
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekEnd.getDate() + 6);
                        dateDisplay.textContent = `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;
                        break;
                    case 'month':
                        dateDisplay.textContent = this.currentDate.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long' 
                        });
                        break;
                    case 'year':
                        dateDisplay.textContent = this.currentDate.getFullYear();
                        break;
                }
            }

            renderDayView() {
                const tasks = this.getTasksForDate(this.currentDate);
                const container = document.getElementById('tasksContainer');
                
                if (tasks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No tasks for this day</h3>
                            <p>Add a task above to get started!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `<div class="tasks-list">${tasks.map(task => this.renderTask(task)).join('')}</div>`;
                this.attachTaskEventListeners();
            }

            renderWeekView() {
                const weekStart = this.getWeekStart(this.currentDate);
                const weekData = this.getTasksForWeek(weekStart);
                const container = document.getElementById('tasksContainer');
                
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                
                container.innerHTML = `
                    <div class="week-view">
                        ${weekData.map((day, index) => `
                            <div class="day-column">
                                <div class="day-header">
                                    ${days[index]}<br>
                                    <small>${day.date.toLocaleDateString()}</small>
                                </div>
                                ${day.tasks.length > 0 ? 
                                    day.tasks.map(task => this.renderTask(task, true)).join('') :
                                    '<p style="text-align: center; color: var(--timber-brown); margin-top: 20px; font-size: 0.9em;">No tasks</p>'
                                }
                            </div>
                        `).join('')}
                    </div>
                `;
                this.attachTaskEventListeners();
            }

            renderMonthView() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();
                
                const container = document.getElementById('tasksContainer');
                const days = [];
                
                // Previous month days
                const prevMonthLastDay = new Date(year, month, 0).getDate();
                for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                    const date = new Date(year, month - 1, prevMonthLastDay - i);
                    days.push({ date, isCurrentMonth: false });
                }
                
                // Current month days
                for (let i = 1; i <= daysInMonth; i++) {
                    const date = new Date(year, month, i);
                    days.push({ date, isCurrentMonth: true });
                }
                
                // Next month days
                const remainingDays = 42 - days.length;
                for (let i = 1; i <= remainingDays; i++) {
                    const date = new Date(year, month + 1, i);
                    days.push({ date, isCurrentMonth: false });
                }
                
                const today = new Date();
                
                container.innerHTML = `
                    <div class="month-view">
                        ${days.map(day => {
                            const tasks = this.getTasksForDate(day.date);
                            const isToday = day.date.toDateString() === today.toDateString();
                            return `
                                <div class="month-day ${!day.isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}">
                                    <div class="month-day-number">${day.date.getDate()}</div>
                                    ${tasks.length > 0 ? `<div class="task-count">${tasks.length} task${tasks.length > 1 ? 's' : ''}</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            renderYearView() {
                const year = this.currentDate.getFullYear();
                const container = document.getElementById('tasksContainer');
                const months = [
                    'January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'
                ];
                
                container.innerHTML = `
                    <div class="year-view">
                        ${months.map((monthName, index) => {
                            const tasks = this.getTasksForMonth(year, index);
                            return `
                                <div class="month-card">
                                    <div class="month-name">${monthName}</div>
                                    <div style="text-align: center; font-size: 2em; color: var(--timber-brown); margin: 20px 0;">
                                        ${tasks.length}
                                    </div>
                                    <div style="text-align: center; color: var(--timber-brown);">
                                        task${tasks.length !== 1 ? 's' : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            renderTask(task, compact = false) {
                const badgeClass = {
                    daily: 'badge-daily',
                    weekly: 'badge-weekly',
                    monthly: 'badge-monthly',
                    yearly: 'badge-yearly'
                };

                if (compact) {
                    return `
                        <div class="task-item ${task.completed ? 'completed' : ''}" style="padding: 10px; margin-bottom: 10px;">
                            <div class="task-title" style="font-size: 0.85em; margin-bottom: 8px;">${task.title}</div>
                            <div class="task-actions" style="margin-top: 5px;">
                                <button class="complete-btn" data-id="${task.id}" style="padding: 4px 8px; font-size: 0.75em;">
                                    ${task.completed ? '‚Ü©' : '‚úì'}
                                </button>
                                <button class="edit-btn" data-id="${task.id}" style="padding: 4px 8px; font-size: 0.75em;">‚úé</button>
                                <button class="delete-btn" data-id="${task.id}" style="padding: 4px 8px; font-size: 0.75em;">‚úï</button>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="task-item ${task.completed ? 'completed' : ''}">
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                        </div>
                        <div class="task-meta">
                            <span class="task-badge ${badgeClass[task.type]}">${task.type}</span>
                            <span class="task-date">üìÖ ${new Date(task.date).toLocaleDateString()}</span>
                        </div>
                        ${task.notes ? `<div class="task-notes">${task.notes}</div>` : ''}
                        <div class="task-actions">
                            <button class="complete-btn" data-id="${task.id}">
                                ${task.completed ? 'Undo' : 'Complete'}
                            </button>
                            <button class="edit-btn" data-id="${task.id}">Edit</button>
                            <button class="delete-btn" data-id="${task.id}">Delete</button>
                        </div>
                    </div>
                `;
            }

            attachTaskEventListeners() {
                document.querySelectorAll('.complete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.toggleComplete(id);
                    });
                });

                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.openEditModal(id);
                    });
                });

                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.deleteTask(id);
                    });
                });
            }

            exportToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let tasksToExport = [];
                let title = '';

                switch(this.currentView) {
                    case 'day':
                        tasksToExport = this.getTasksForDate(this.currentDate);
                        title = `Tasks for ${this.formatDateDisplay(this.currentDate)}`;
                        break;
                    case 'week':
                        const weekStart = this.getWeekStart(this.currentDate);
                        const weekEnd = new Date(weekStart);
                        weekEnd.setDate(weekEnd.getDate() + 6);
                        tasksToExport = this.tasks.filter(t => {
                            const taskDate = new Date(t.date);
                            return taskDate >= weekStart && taskDate <= weekEnd;
                        });
                        title = `Weekly Tasks: ${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;
                        break;
                    case 'month':
                        tasksToExport = this.getTasksForMonth(
                            this.currentDate.getFullYear(),
                            this.currentDate.getMonth()
                        );
                        title = `Monthly Tasks: ${this.currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' })}`;
                        break;
                    case 'year':
                        tasksToExport = this.getTasksForYear(this.currentDate.getFullYear());
                        title = `Yearly Tasks: ${this.currentDate.getFullYear()}`;
                        break;
                }

                // Set colors matching our theme
                const timberDark = [44, 36, 22];
                const timberBrown = [90, 74, 58];
                const accentOrange = [200, 121, 65];

                // Title
                doc.setFontSize(20);
                doc.setTextColor(...timberDark);
                doc.text(title, 20, 20);

                // Add decorative line
                doc.setDrawColor(...accentOrange);
                doc.setLineWidth(0.5);
                doc.line(20, 25, 190, 25);

                let yPos = 35;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;

                if (tasksToExport.length === 0) {
                    doc.setFontSize(12);
                    doc.setTextColor(...timberBrown);
                    doc.text('No tasks for this period', 20, yPos);
                } else {
                    tasksToExport.forEach((task, index) => {
                        // Check if we need a new page
                        if (yPos > pageHeight - 40) {
                            doc.addPage();
                            yPos = 20;
                        }

                        // Task number and title
                        doc.setFontSize(14);
                        doc.setTextColor(...timberDark);
                        doc.text(`${index + 1}. ${task.title}`, margin, yPos);
                        yPos += 7;

                        // Task metadata
                        doc.setFontSize(10);
                        doc.setTextColor(...timberBrown);
                        const metadata = `Type: ${task.type} | Date: ${new Date(task.date).toLocaleDateString()} | Status: ${task.completed ? 'Completed' : 'Pending'}`;
                        doc.text(metadata, margin + 5, yPos);
                        yPos += 6;

                        // Notes if present
                        if (task.notes) {
                            doc.setFontSize(10);
                            doc.setTextColor(...timberBrown);
                            const lines = doc.splitTextToSize(`Notes: ${task.notes}`, 170);
                            doc.text(lines, margin + 5, yPos);
                            yPos += (lines.length * 5) + 3;
                        }

                        // Separator line
                        doc.setDrawColor(212, 196, 176); // timber-cream
                        doc.setLineWidth(0.3);
                        doc.line(margin, yPos, 190, yPos);
                        yPos += 8;
                    });
                }

                // Footer
                const totalPages = doc.internal.pages.length - 1;
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(...timberBrown);
                    doc.text(
                        `Page ${i} of ${totalPages} | Generated: ${new Date().toLocaleDateString()}`,
                        margin,
                        pageHeight - 10
                    );
                }

                // Save the PDF
                const filename = `tasks_${this.currentView}_${this.formatDate(this.currentDate)}.pdf`;
                doc.save(filename);
            }

            saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
            }

            loadTasks() {
                const saved = localStorage.getItem('tasks');
                return saved ? JSON.parse(saved) : [];
            }
        }

        // Initialize the app
        new TaskManager();
    </script>
</body>
</html>
